import{d as M,s as S,c as d,j as o,a as t,w as l,b as s,r as v,P as m,o as r,f as c,t as u,h as _,F as y,Q as k,k as p}from"./index-DwXYDVfX.js";import{h as K,_ as g}from"./createLucideIcon-CJtCUzSt.js";import{_ as w}from"./ScrollArea.vue_vue_type_script_setup_true_lang-aO42o2uT.js";import{_ as C,a as $,b}from"./index-Da6jFbbE.js";import{_ as L,d as O,e as R,f as j,X as A}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BAvvERyw.js";const B=K("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),T={class:"flex h-full w-full flex-col p-6 overflow-hidden bg-background"},D={key:0,class:"ml-2 bg-red-500 text-white text-[10px] px-1.5 rounded-full"},E={key:0,class:"ml-2 bg-red-500 text-white text-[10px] px-1.5 rounded-full"},I={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},P={class:"font-medium"},Q={class:"text-sm text-muted-foreground"},U={key:0,class:"col-span-full text-center text-muted-foreground py-10"},W={class:"space-y-4"},X={class:"flex items-center gap-4"},H={class:"font-medium"},J={class:"text-sm text-muted-foreground"},Y={class:"text-xs text-muted-foreground"},Z={key:0,class:"flex gap-2"},ee={key:1,class:"text-sm text-muted-foreground"},te={key:0,class:"text-center text-muted-foreground py-10"},se={class:"space-y-4"},ae={class:"flex items-center gap-4"},le={class:"font-medium"},ne={class:"text-sm text-muted-foreground"},oe={class:"text-xs text-muted-foreground"},de={key:0,class:"flex gap-2"},re={key:1,class:"text-sm text-muted-foreground"},ue={key:0,class:"text-center text-muted-foreground py-10"},pe=M({__name:"Contacts",setup(ce){const F=v("friends"),h=v([]),i=v([]),f=v([]),N=async()=>{try{const n=await m.get("/friend/list");h.value=n||[]}catch(n){console.error(n)}},V=async()=>{try{const n=await m.get("/friend/requests");i.value=n||[]}catch(n){console.error(n)}},q=async()=>{try{const n=await m.get("/group/requests");f.value=n||[]}catch(n){console.error(n)}},G=async(n,a)=>{try{await m.post("/friend/handle",{request_id:n,action:a}),p.success(a===1?"Friend request accepted":"Friend request rejected"),V(),N(),useChatStore().fetchRequestCounts()}catch(e){p.error(e.message)}},z=async(n,a)=>{try{await m.post("/group/handle-join",{request_id:n,action:a}),p.success(a===1?"Group request accepted":"Group request rejected"),q(),useChatStore().fetchRequestCounts()}catch(e){p.error(e.message)}};return S(()=>{N(),V(),q()}),(n,a)=>(r(),d("div",T,[a[8]||(a[8]=o("h1",{class:"text-2xl font-bold mb-6"},"Contacts",-1)),t(s(L),{modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=e=>F.value=e),class:"w-full flex-1 flex flex-col"},{default:l(()=>[t(s(O),null,{default:l(()=>[t(s(R),{value:"friends"},{default:l(()=>[...a[1]||(a[1]=[c("My Friends",-1)])]),_:1}),t(s(R),{value:"friend-requests"},{default:l(()=>[a[2]||(a[2]=c(" Friend Requests ",-1)),i.value.length?(r(),d("span",D,u(i.value.length),1)):_("",!0)]),_:1}),t(s(R),{value:"group-requests"},{default:l(()=>[a[3]||(a[3]=c(" Group Requests ",-1)),f.value.length?(r(),d("span",E,u(f.value.length),1)):_("",!0)]),_:1})]),_:1}),t(s(j),{value:"friends",class:"flex-1 mt-4"},{default:l(()=>[t(s(w),{class:"h-full"},{default:l(()=>[o("div",I,[(r(!0),d(y,null,k(h.value,e=>(r(),d("div",{key:e.id,class:"flex items-center gap-4 p-4 border rounded-lg"},[t(s(C),null,{default:l(()=>[t(s($),{src:e.avatar?e.avatar.startsWith("http")?e.avatar:`${n.window.location.protocol}//${n.window.location.hostname}:8000${e.avatar}`:"",cacheKey:`avatar_${e.id}`},null,8,["src","cacheKey"]),t(s(b),null,{default:l(()=>[c(u(e.nickname?.slice(0,2)||e.username.slice(0,2)),1)]),_:2},1024)]),_:2},1024),o("div",null,[o("div",P,u(e.nickname||e.username),1),o("div",Q,u(e.online?"Online":"Offline"),1)])]))),128)),h.value.length===0?(r(),d("div",U," No friends yet ")):_("",!0)])]),_:1})]),_:1}),t(s(j),{value:"friend-requests",class:"flex-1 mt-4"},{default:l(()=>[t(s(w),{class:"h-full"},{default:l(()=>[o("div",W,[(r(!0),d(y,null,k(i.value,e=>(r(),d("div",{key:e.id,class:"flex items-center justify-between p-4 border rounded-lg"},[o("div",X,[t(s(C),null,{default:l(()=>[t(s($),{src:e.avatar},null,8,["src"]),t(s(b),null,{default:l(()=>[c(u(e.sender_name?.slice(0,2)),1)]),_:2},1024)]),_:2},1024),o("div",null,[o("div",H,u(e.sender_name),1),o("div",J,u(e.remark||"No remark"),1),o("div",Y,u(e.created_at),1)])]),e.status===0?(r(),d("div",Z,[t(s(g),{size:"sm",variant:"outline",onClick:x=>G(e.id,2)},{default:l(()=>[t(s(A),{class:"w-4 h-4 mr-1"}),a[4]||(a[4]=c(" Reject ",-1))]),_:1},8,["onClick"]),t(s(g),{size:"sm",onClick:x=>G(e.id,1)},{default:l(()=>[t(s(B),{class:"w-4 h-4 mr-1"}),a[5]||(a[5]=c(" Accept ",-1))]),_:1},8,["onClick"])])):(r(),d("div",ee,u(e.status===1?"Accepted":"Rejected"),1))]))),128)),i.value.length===0?(r(),d("div",te," No pending friend requests ")):_("",!0)])]),_:1})]),_:1}),t(s(j),{value:"group-requests",class:"flex-1 mt-4"},{default:l(()=>[t(s(w),{class:"h-full"},{default:l(()=>[o("div",se,[(r(!0),d(y,null,k(f.value,e=>(r(),d("div",{key:e.id,class:"flex items-center justify-between p-4 border rounded-lg"},[o("div",ae,[t(s(C),null,{default:l(()=>[t(s($),{src:e.avatar},null,8,["src"]),t(s(b),null,{default:l(()=>[c(u(e.sender_name?.slice(0,2)),1)]),_:2},1024)]),_:2},1024),o("div",null,[o("div",le,u(e.sender_name)+" wants to join "+u(e.group_name),1),o("div",ne,u(e.remark||"No remark"),1),o("div",oe,u(e.created_at),1)])]),e.status===0?(r(),d("div",de,[t(s(g),{size:"sm",variant:"outline",onClick:x=>z(e.id,2)},{default:l(()=>[t(s(A),{class:"w-4 h-4 mr-1"}),a[6]||(a[6]=c(" Reject ",-1))]),_:1},8,["onClick"]),t(s(g),{size:"sm",onClick:x=>z(e.id,1)},{default:l(()=>[t(s(B),{class:"w-4 h-4 mr-1"}),a[7]||(a[7]=c(" Accept ",-1))]),_:1},8,["onClick"])])):(r(),d("div",re,u(e.status===1?"Accepted":"Rejected"),1))]))),128)),f.value.length===0?(r(),d("div",ue," No pending group requests ")):_("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{pe as default};
