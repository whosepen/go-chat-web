import{d as k,o as v,g as $,w as l,x as B,y as L,b as e,u as F,s as K,c as C,j as p,a as s,h as V,r as g,f as d,t as P,P as b,X as T,k as y}from"./index-DwXYDVfX.js";import{P as W,r as O,j as X,_ as x}from"./createLucideIcon-CJtCUzSt.js";import{_ as z,C as G,a as H,b as J,c as m}from"./circle-alert-B-Swg1hJ.js";import{u as Q,_ as R,a as Y,b as Z}from"./index-Da6jFbbE.js";import{_ as U,a as h,b as I,c as S,d as N}from"./CardTitle.vue_vue_type_script_setup_true_lang-CsA6xLkN.js";import{L as A}from"./loader-circle-bIxhJ_k5.js";var aa=k({__name:"Label",props:{for:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"label"}},setup(w){const t=w;return Q(),(n,u)=>(v(),$(e(W),L(t,{onMousedown:u[0]||(u[0]=o=>{!o.defaultPrevented&&o.detail>1&&o.preventDefault()})}),{default:l(()=>[B(n.$slots,"default")]),_:3},16))}}),ea=aa;const _=k({__name:"Label",props:{for:{},asChild:{type:Boolean},as:{},class:{}},setup(w){const t=w,n=O(t,"class");return(u,o)=>(v(),$(e(ea),L(e(n),{class:e(X)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t.class)}),{default:l(()=>[B(u.$slots,"default")]),_:3},16,["class"]))}}),sa={class:"flex h-full w-full flex-col p-6 overflow-y-auto"},la={class:"max-w-2xl w-full space-y-6"},oa={key:0,class:"mb-4"},ta={class:"flex items-center gap-4"},ra={class:"grid w-full max-w-sm items-center gap-1.5"},da={class:"grid gap-2"},na={class:"grid gap-2"},ua={class:"grid gap-2"},ia={class:"grid gap-2"},pa={class:"grid gap-2"},fa={class:"grid gap-2"},ya=k({__name:"Settings",setup(w){const t=F(),n=g(!1),u=g(""),o=g({nickname:"",email:"",phone:"",avatar:""}),i=g({old_password:"",new_password:"",confirm_password:""});K(()=>{t.userInfo&&(o.value={nickname:t.userInfo.nickname||"",email:t.userInfo.email||"",phone:t.userInfo.phone||"",avatar:t.userInfo.avatar||""})});const E=async f=>{const a=f.target.files?.[0];if(a)try{const r=await b.post("/media/upload",{filename:a.name,type:"avatar"},{silent:!0}),{put_url:j,file_url:c}=r;if(await T.put(j,a,{headers:{"Content-Type":a.type||"application/octet-stream"}}),o.value.avatar=c,t.userInfo?.id){const D=c.startsWith("http")?c:`${window.location.protocol}//${window.location.hostname}:8000${c}`;localStorage.setItem(`avatar_${t.userInfo.id}`,D)}y.success("Avatar uploaded")}catch(r){y.error("Avatar upload failed: "+r.message)}},q=async()=>{n.value=!0,u.value="";try{await b.post("/user/info/update",o.value,{silent:!0}),y.success("Profile updated"),await t.fetchUserInfo()}catch(f){u.value=f.message}finally{n.value=!1}},M=async()=>{if(i.value.new_password!==i.value.confirm_password){u.value="New passwords do not match";return}n.value=!0,u.value="";try{await b.post("/user/password/update",{old_password:i.value.old_password,new_password:i.value.new_password},{silent:!0}),y.success("Password updated"),i.value={old_password:"",new_password:"",confirm_password:""}}catch(f){u.value=f.message}finally{n.value=!1}};return(f,a)=>(v(),C("div",sa,[a[18]||(a[18]=p("h1",{class:"text-2xl font-bold mb-6"},"Settings",-1)),p("div",la,[u.value?(v(),C("div",oa,[s(e(z),{variant:"destructive"},{default:l(()=>[s(e(G),{class:"w-4 h-4"}),s(e(H),null,{default:l(()=>[...a[6]||(a[6]=[d("Error",-1)])]),_:1}),s(e(J),null,{default:l(()=>[d(P(u.value),1)]),_:1})]),_:1})])):V("",!0),s(e(U),null,{default:l(()=>[s(e(h),null,{default:l(()=>[s(e(I),null,{default:l(()=>[...a[7]||(a[7]=[d("Profile",-1)])]),_:1})]),_:1}),s(e(S),{class:"space-y-4"},{default:l(()=>[p("div",ta,[s(e(R),{class:"h-20 w-20"},{default:l(()=>[s(e(Y),{src:o.value.avatar?o.value.avatar.startsWith("http")?o.value.avatar:`${f.window.location.protocol}//${f.window.location.hostname}:8000${o.value.avatar}`:"",cacheKey:e(t).userInfo?.id?`avatar_${e(t).userInfo.id}`:void 0},null,8,["src","cacheKey"]),s(e(Z),null,{default:l(()=>[d(P(o.value.nickname?.slice(0,2).toUpperCase()),1)]),_:1})]),_:1}),p("div",ra,[s(e(_),{for:"avatar"},{default:l(()=>[...a[8]||(a[8]=[d("Avatar",-1)])]),_:1}),s(e(m),{id:"avatar",type:"file",accept:"image/*",onChange:E})])]),p("div",da,[s(e(_),{for:"nickname"},{default:l(()=>[...a[9]||(a[9]=[d("Nickname",-1)])]),_:1}),s(e(m),{id:"nickname",modelValue:o.value.nickname,"onUpdate:modelValue":a[0]||(a[0]=r=>o.value.nickname=r)},null,8,["modelValue"])]),p("div",na,[s(e(_),{for:"email"},{default:l(()=>[...a[10]||(a[10]=[d("Email",-1)])]),_:1}),s(e(m),{id:"email",modelValue:o.value.email,"onUpdate:modelValue":a[1]||(a[1]=r=>o.value.email=r),type:"email"},null,8,["modelValue"])]),p("div",ua,[s(e(_),{for:"phone"},{default:l(()=>[...a[11]||(a[11]=[d("Phone",-1)])]),_:1}),s(e(m),{id:"phone",modelValue:o.value.phone,"onUpdate:modelValue":a[2]||(a[2]=r=>o.value.phone=r)},null,8,["modelValue"])])]),_:1}),s(e(N),null,{default:l(()=>[s(e(x),{onClick:q,disabled:n.value},{default:l(()=>[n.value?(v(),$(e(A),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):V("",!0),a[12]||(a[12]=d(" Save Changes ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1}),s(e(U),null,{default:l(()=>[s(e(h),null,{default:l(()=>[s(e(I),null,{default:l(()=>[...a[13]||(a[13]=[d("Security",-1)])]),_:1})]),_:1}),s(e(S),{class:"space-y-4"},{default:l(()=>[p("div",ia,[s(e(_),{for:"old_password"},{default:l(()=>[...a[14]||(a[14]=[d("Current Password",-1)])]),_:1}),s(e(m),{id:"old_password",type:"password",modelValue:i.value.old_password,"onUpdate:modelValue":a[3]||(a[3]=r=>i.value.old_password=r)},null,8,["modelValue"])]),p("div",pa,[s(e(_),{for:"new_password"},{default:l(()=>[...a[15]||(a[15]=[d("New Password",-1)])]),_:1}),s(e(m),{id:"new_password",type:"password",modelValue:i.value.new_password,"onUpdate:modelValue":a[4]||(a[4]=r=>i.value.new_password=r)},null,8,["modelValue"])]),p("div",fa,[s(e(_),{for:"confirm_password"},{default:l(()=>[...a[16]||(a[16]=[d("Confirm New Password",-1)])]),_:1}),s(e(m),{id:"confirm_password",type:"password",modelValue:i.value.confirm_password,"onUpdate:modelValue":a[5]||(a[5]=r=>i.value.confirm_password=r)},null,8,["modelValue"])])]),_:1}),s(e(N),null,{default:l(()=>[s(e(x),{onClick:M,disabled:n.value},{default:l(()=>[n.value?(v(),$(e(A),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):V("",!0),a[17]||(a[17]=d(" Update Password ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])]))}});export{ya as default};
