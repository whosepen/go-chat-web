import{d as k,o as v,g as y,w as l,s as L,v as A,b as e,u as F,B as O,c as C,j as p,a as s,h as V,r as c,f as r,t as $,H as b,O as T,k as g}from"./index-DdbpnQh1.js";import{P as j,r as H,h as z,_ as x}from"./createLucideIcon-DfyR5A8Z.js";import{_ as G,C as J,a as K,b as Q,c as f}from"./circle-alert-Buqbgg0e.js";import{u as R,_ as W,a as X,b as Y}from"./index-Bevz_C_5.js";import{_ as P,a as U,b as S,c as N,d as B}from"./CardTitle.vue_vue_type_script_setup_true_lang-K1gKcX0w.js";import{L as I}from"./loader-circle-C6qkK8XE.js";var Z=k({__name:"Label",props:{for:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"label"}},setup(w){const u=w;return R(),(d,n)=>(v(),y(e(j),A(u,{onMousedown:n[0]||(n[0]=o=>{!o.defaultPrevented&&o.detail>1&&o.preventDefault()})}),{default:l(()=>[L(d.$slots,"default")]),_:3},16))}}),aa=Z;const m=k({__name:"Label",props:{for:{},asChild:{type:Boolean},as:{},class:{}},setup(w){const u=w,d=H(u,"class");return(n,o)=>(v(),y(e(aa),A(e(d),{class:e(z)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",u.class)}),{default:l(()=>[L(n.$slots,"default")]),_:3},16,["class"]))}}),ea={class:"flex h-full w-full flex-col p-6 overflow-y-auto"},sa={class:"max-w-2xl w-full space-y-6"},la={key:0,class:"mb-4"},oa={class:"flex items-center gap-4"},ta={class:"grid w-full max-w-sm items-center gap-1.5"},ra={class:"grid gap-2"},da={class:"grid gap-2"},na={class:"grid gap-2"},ua={class:"grid gap-2"},ia={class:"grid gap-2"},pa={class:"grid gap-2"},ga=k({__name:"Settings",setup(w){const u=F(),d=c(!1),n=c(""),o=c({nickname:"",email:"",phone:"",avatar:""}),i=c({old_password:"",new_password:"",confirm_password:""});O(()=>{u.userInfo&&(o.value={nickname:u.userInfo.nickname||"",email:u.userInfo.email||"",phone:u.userInfo.phone||"",avatar:u.userInfo.avatar||""})});const h=async _=>{const a=_.target.files?.[0];if(a)try{const t=await b.post("/media/upload",{filename:a.name,type:"avatar"},{silent:!0}),{put_url:M,file_url:D}=t;await T.put(M,a,{headers:{"Content-Type":a.type||"application/octet-stream"}}),o.value.avatar=D,g.success("Avatar uploaded")}catch(t){g.error("Avatar upload failed: "+t.message)}},E=async()=>{d.value=!0,n.value="";try{await b.post("/user/info/update",o.value,{silent:!0}),g.success("Profile updated"),await u.fetchUserInfo()}catch(_){n.value=_.message}finally{d.value=!1}},q=async()=>{if(i.value.new_password!==i.value.confirm_password){n.value="New passwords do not match";return}d.value=!0,n.value="";try{await b.post("/user/password/update",{old_password:i.value.old_password,new_password:i.value.new_password},{silent:!0}),g.success("Password updated"),i.value={old_password:"",new_password:"",confirm_password:""}}catch(_){n.value=_.message}finally{d.value=!1}};return(_,a)=>(v(),C("div",ea,[a[18]||(a[18]=p("h1",{class:"text-2xl font-bold mb-6"},"Settings",-1)),p("div",sa,[n.value?(v(),C("div",la,[s(e(G),{variant:"destructive"},{default:l(()=>[s(e(J),{class:"w-4 h-4"}),s(e(K),null,{default:l(()=>[...a[6]||(a[6]=[r("Error",-1)])]),_:1}),s(e(Q),null,{default:l(()=>[r($(n.value),1)]),_:1})]),_:1})])):V("",!0),s(e(P),null,{default:l(()=>[s(e(U),null,{default:l(()=>[s(e(S),null,{default:l(()=>[...a[7]||(a[7]=[r("Profile",-1)])]),_:1})]),_:1}),s(e(N),{class:"space-y-4"},{default:l(()=>[p("div",oa,[s(e(W),{class:"h-20 w-20"},{default:l(()=>[s(e(X),{src:o.value.avatar},null,8,["src"]),s(e(Y),null,{default:l(()=>[r($(o.value.nickname?.slice(0,2).toUpperCase()),1)]),_:1})]),_:1}),p("div",ta,[s(e(m),{for:"avatar"},{default:l(()=>[...a[8]||(a[8]=[r("Avatar",-1)])]),_:1}),s(e(f),{id:"avatar",type:"file",accept:"image/*",onChange:h})])]),p("div",ra,[s(e(m),{for:"nickname"},{default:l(()=>[...a[9]||(a[9]=[r("Nickname",-1)])]),_:1}),s(e(f),{id:"nickname",modelValue:o.value.nickname,"onUpdate:modelValue":a[0]||(a[0]=t=>o.value.nickname=t)},null,8,["modelValue"])]),p("div",da,[s(e(m),{for:"email"},{default:l(()=>[...a[10]||(a[10]=[r("Email",-1)])]),_:1}),s(e(f),{id:"email",modelValue:o.value.email,"onUpdate:modelValue":a[1]||(a[1]=t=>o.value.email=t),type:"email"},null,8,["modelValue"])]),p("div",na,[s(e(m),{for:"phone"},{default:l(()=>[...a[11]||(a[11]=[r("Phone",-1)])]),_:1}),s(e(f),{id:"phone",modelValue:o.value.phone,"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.phone=t)},null,8,["modelValue"])])]),_:1}),s(e(B),null,{default:l(()=>[s(e(x),{onClick:E,disabled:d.value},{default:l(()=>[d.value?(v(),y(e(I),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):V("",!0),a[12]||(a[12]=r(" Save Changes ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1}),s(e(P),null,{default:l(()=>[s(e(U),null,{default:l(()=>[s(e(S),null,{default:l(()=>[...a[13]||(a[13]=[r("Security",-1)])]),_:1})]),_:1}),s(e(N),{class:"space-y-4"},{default:l(()=>[p("div",ua,[s(e(m),{for:"old_password"},{default:l(()=>[...a[14]||(a[14]=[r("Current Password",-1)])]),_:1}),s(e(f),{id:"old_password",type:"password",modelValue:i.value.old_password,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value.old_password=t)},null,8,["modelValue"])]),p("div",ia,[s(e(m),{for:"new_password"},{default:l(()=>[...a[15]||(a[15]=[r("New Password",-1)])]),_:1}),s(e(f),{id:"new_password",type:"password",modelValue:i.value.new_password,"onUpdate:modelValue":a[4]||(a[4]=t=>i.value.new_password=t)},null,8,["modelValue"])]),p("div",pa,[s(e(m),{for:"confirm_password"},{default:l(()=>[...a[16]||(a[16]=[r("Confirm New Password",-1)])]),_:1}),s(e(f),{id:"confirm_password",type:"password",modelValue:i.value.confirm_password,"onUpdate:modelValue":a[5]||(a[5]=t=>i.value.confirm_password=t)},null,8,["modelValue"])])]),_:1}),s(e(B),null,{default:l(()=>[s(e(x),{onClick:q,disabled:d.value},{default:l(()=>[d.value?(v(),y(e(I),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):V("",!0),a[17]||(a[17]=r(" Update Password ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])]))}});export{ga as default};
