import{b as O,P as g,i as S,j as E,p as L}from"./createLucideIcon-CJtCUzSt.js";import{a2 as P,a5 as R,$,l as _,r as d,d as v,o as p,g as h,w as y,x as m,b as i,p as x,h as j,s as q,q as I,v as K,m as k,U as B,a7 as M,O as U,C as z,D as F,P as D,y as W}from"./index-DwXYDVfX.js";function T(t,e){const a=typeof t=="string"&&!e?`${t}Context`:e,s=Symbol(a);return[n=>{const u=P(s,n);if(u||u===null)return u;throw new Error(`Injection \`${s.toString()}\` not found. Component must be used within ${Array.isArray(t)?`one of the following components: ${t.join(", ")}`:`\`${t}\``}`)},n=>(R(s,n),n)]}function b(){const t=$(),e=d(),a=_(()=>["#text","#comment"].includes(e.value?.$el.nodeName)?e.value?.$el.nextElementSibling:O(e)),s=Object.assign({},t.exposed),o={};for(const n in t.props)Object.defineProperty(o,n,{enumerable:!0,configurable:!0,get:()=>t.props[n]});if(Object.keys(s).length>0)for(const n in s)Object.defineProperty(o,n,{enumerable:!0,configurable:!0,get:()=>s[n]});Object.defineProperty(o,"$el",{enumerable:!0,configurable:!0,get:()=>t.vnode.el}),t.exposed=o;function c(n){if(e.value=n,!!n&&(Object.defineProperty(o,"$el",{enumerable:!0,configurable:!0,get:()=>n instanceof Element?n:n.$el}),!(n instanceof Element)&&!Object.hasOwn(n,"$el"))){const u=n.$.exposed,l=Object.assign({},o);for(const r in u)Object.defineProperty(l,r,{enumerable:!0,configurable:!0,get:()=>u[r]});t.exposed=l}}return{forwardRef:c,currentRef:e,currentElement:a}}const[A,G]=T("AvatarRoot");var H=v({__name:"AvatarRoot",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(t){return b(),G({imageLoadingStatus:d("idle")}),(e,a)=>(p(),h(i(g),{"as-child":e.asChild,as:e.as},{default:y(()=>[m(e.$slots,"default")]),_:3},8,["as-child","as"]))}}),J=H,Q=v({__name:"AvatarFallback",props:{delayMs:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(t){const e=t,a=A();b();const s=d(e.delayMs===void 0);return x(o=>{if(e.delayMs&&S){const c=window.setTimeout(()=>{s.value=!0},e.delayMs);o(()=>{window.clearTimeout(c)})}}),(o,c)=>s.value&&i(a).imageLoadingStatus.value!=="loaded"?(p(),h(i(g),{key:0,"as-child":o.asChild,as:o.as},{default:y(()=>[m(o.$slots,"default")]),_:3},8,["as-child","as"])):j("v-if",!0)}}),X=Q;function C(t,e){return t?e?(t.src!==e&&(t.src=e),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Y(t,{referrerPolicy:e,crossOrigin:a}={}){const s=d(!1),o=d(null),c=_(()=>s.value?(!o.value&&S&&(o.value=new window.Image),o.value):null),n=d(C(c.value,t.value)),u=l=>()=>{s.value&&(n.value=l)};return q(()=>{s.value=!0,x(l=>{const r=c.value;if(!r)return;n.value=C(r,t.value);const f=u("loaded"),w=u("error");r.addEventListener("load",f),r.addEventListener("error",w),e?.value&&(r.referrerPolicy=e.value),typeof a?.value=="string"&&(r.crossOrigin=a.value),l(()=>{r.removeEventListener("load",f),r.removeEventListener("error",w)})})}),I(()=>{s.value=!1}),n}var Z=v({__name:"AvatarImage",props:{src:{type:String,required:!0},referrerPolicy:{type:null,required:!1},crossOrigin:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"img"}},emits:["loadingStatusChange"],setup(t,{emit:e}){const a=t,s=e,{src:o,referrerPolicy:c,crossOrigin:n}=K(a);b();const u=A(),l=Y(o,{referrerPolicy:c,crossOrigin:n});return k(l,r=>{s("loadingStatusChange",r),r!=="idle"&&(u.imageLoadingStatus.value=r)},{immediate:!0}),(r,f)=>B((p(),h(i(g),{role:"img","as-child":r.asChild,as:r.as,src:i(o),referrerpolicy:i(c),crossorigin:i(n)},{default:y(()=>[m(r.$slots,"default")]),_:3},8,["as-child","as","src","referrerpolicy","crossorigin"])),[[M,i(l)==="loaded"]])}}),V=Z;const se=v({__name:"Avatar",props:{class:{},size:{default:"sm"},shape:{default:"circle"}},setup(t){const e=t;return(a,s)=>(p(),h(i(J),{class:U(i(E)(i(te)({size:t.size,shape:t.shape}),e.class))},{default:y(()=>[m(a.$slots,"default")]),_:3},8,["class"]))}}),ne=v({__name:"AvatarFallback",props:{delayMs:{},asChild:{type:Boolean},as:{}},setup(t){const e=t;return(a,s)=>(p(),h(i(X),z(F(e)),{default:y(()=>[m(a.$slots,"default")]),_:3},16))}}),N=t=>{try{const a=new URL(t).pathname,s=a.startsWith("/")?a.slice(1):a;return s.startsWith("user-avatars/")?{key:s.replace("user-avatars/",""),type:"avatar"}:s.startsWith("chat-files/")?{key:s.replace("chat-files/",""),type:"chat"}:null}catch{return console.error("Invalid URL:",t),null}},ee=async t=>{const e=N(t);if(!e)return null;try{return(await D.post("/media/download",{key:e.key,type:e.type},{silent:!0})).download_url}catch(a){return console.error("Failed to refresh download url:",a),null}},oe=v({__name:"AvatarImage",props:{src:{},referrerPolicy:{},crossOrigin:{},asChild:{type:Boolean},as:{},cacheKey:{}},setup(t){const e=t,a=d(void 0),s=d(0),o=d(!1),c=_(()=>{const{cacheKey:l,src:r,...f}=e;return f});k(()=>[e.src,e.cacheKey],()=>{if(s.value=0,o.value=!1,e.cacheKey)try{const r=localStorage.getItem(e.cacheKey);if(r){a.value=r;return}}catch(r){console.warn("LocalStorage access failed",r)}const l=e.src;l?a.value=l:a.value=void 0},{immediate:!0});const u=async()=>{if(o.value)return;const l=e.src;if(e.cacheKey&&l&&a.value!==l){a.value=l;return}if(s.value<1&&a.value){o.value=!0,s.value++;const r=await ee(a.value);if(o.value=!1,r){if(a.value=r,e.cacheKey)try{localStorage.setItem(e.cacheKey,r)}catch{}return}}a.value=void 0};return(l,r)=>a.value?(p(),h(i(V),W({key:0},c.value,{src:a.value,onLoadingStatusChange:r[0]||(r[0]=f=>{f==="error"&&u()}),class:"h-full w-full object-cover"}),null,16,["src"])):j("",!0)}}),te=L("inline-flex items-center justify-center font-normal text-foreground select-none shrink-0 bg-secondary overflow-hidden",{variants:{size:{sm:"h-10 w-10 text-xs",base:"h-16 w-16 text-2xl",lg:"h-32 w-32 text-5xl"},shape:{circle:"rounded-full",square:"rounded-md"}}});export{se as _,oe as a,ne as b,T as c,b as u};
